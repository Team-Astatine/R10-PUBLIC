package org.Astatine.r10.Contents.Restricted.AntiExploit.Interaction.PlayerInteraction;

import org.Astatine.r10.Contents.EventRegister;
import org.Astatine.r10.Contents.Restricted.AntiExploit.RestrictedElement;
import org.Astatine.r10.Enumeration.Type.ColorType;
import org.Astatine.r10.Util.Function.StringComponentExchanger;
import org.apache.commons.lang3.BooleanUtils;
import org.bukkit.entity.Player;
import org.bukkit.event.player.PlayerCommandPreprocessEvent;

public class RestrictedCommandHandler extends StringComponentExchanger implements EventRegister {
    private Player commandSender;
    private String currentCommand;

    private final PlayerCommandPreprocessEvent event;

    public RestrictedCommandHandler(PlayerCommandPreprocessEvent event) {
        this.event = event;
        init();
        execute();
    }

    @Override
    public void init() {
        this.commandSender = this.event.getPlayer();
        this.currentCommand = this.event.getMessage();
    }

    @Override
    public void execute() {
        if (this.commandSender.isOp())
            return;

        boolean commandAllowed = new RestrictedElement().restrictedCommand.stream()
                .anyMatch(this.currentCommand::equals);

        if (BooleanUtils.isFalse(commandAllowed))
            return;

        this.event.setCancelled(true);
        playerSendMsgComponentExchanger(this.commandSender, "해당 명령어는 사용불가합니다.", ColorType.RED);
    }
}
