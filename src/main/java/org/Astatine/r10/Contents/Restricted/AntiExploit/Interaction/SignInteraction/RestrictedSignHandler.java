package org.Astatine.r10.Contents.Restricted.AntiExploit.Interaction.SignInteraction;

import org.Astatine.r10.Contents.EventRegister;
import org.Astatine.r10.Util.Function.StringComponentExchanger;
import org.bukkit.Material;
import org.bukkit.block.Sign;
import org.bukkit.block.sign.Side;
import org.bukkit.block.sign.SignSide;

import io.papermc.paper.event.player.PlayerOpenSignEvent;
import net.kyori.adventure.text.Component;
import net.kyori.adventure.text.TextComponent;

public class RestrictedSignHandler extends StringComponentExchanger implements EventRegister {

    private final PlayerOpenSignEvent event;

    public RestrictedSignHandler(PlayerOpenSignEvent event) {
        this.event = event;

        init();
        execute();
    }

    @Override
    public void init() {}

    @Override
    public void execute() {
        Sign sign = event.getSign();

        for (Side sideType : new Side[]{Side.FRONT, Side.BACK}) {
            SignSide side = sign.getSide(sideType);
            int totalLength = 0;

            for (Component lineComp : side.lines())
                totalLength += ((TextComponent) lineComp).content().length();

            if (totalLength < 45)
                return;

            sign.getBlock().setType(Material.AIR);
        }
    }
}
